<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>GoLike TikTok Tool (Login + Debug)</title>
  <style>
    body { font-family: Arial; background: #f4f4f4; padding: 20px; }
    input, button { padding: 8px; margin: 5px; width: 90%; }
    .job { background: #fff; padding: 10px; margin: 10px 0; border-radius: 6px; }
    #status { font-weight: bold; color: green; }
    #log { background: #222; color: #eee; padding: 10px; height: 150px; overflow-y: auto; font-size: 12px; }
  </style>
</head>
<body>
  <h2>üîß GoLike TikTok Tool (Login + Debug)</h2>

  <label>Email:</label><br>
  <input type="text" id="email" placeholder="Nh·∫≠p email"><br>
  <label>M·∫≠t kh·∫©u:</label><br>
  <input type="password" id="password" placeholder="Nh·∫≠p m·∫≠t kh·∫©u"><br>
  <label>Proxy CORS (n·∫øu b·ªã l·ªói k·∫øt n·ªëi):</label><br>
  <input type="text" id="proxy" placeholder="V√≠ d·ª•: https://cors-anywhere.herokuapp.com/"><br>
  <button onclick="login()">ƒêƒÉng nh·∫≠p & B·∫Øt ƒë·∫ßu</button>

  <p id="status"></p>

  <h3>Danh s√°ch Job TikTok:</h3>
  <div id="jobList"></div>

  <h3>ƒê√£ l√†m: <span id="doneCount">0</span> job | T·ªïng ti·ªÅn: <span id="totalMoney">0</span>ƒë</h3>

  <h3>üìù Debug Log</h3>
  <div id="log">Console s·∫Ω hi·ªán th√¥ng tin chi ti·∫øt ·ªü ƒë√¢y...</div>

  <script>
    const logDiv = document.getElementById('log');
    function debug(msg, obj) {
      const t = document.createElement('div');
      t.textContent = msg + (obj !== undefined ? ' ‚áí ' + JSON.stringify(obj) : '');
      logDiv.appendChild(t);
      logDiv.scrollTop = logDiv.scrollHeight;
      console.log(msg, obj);
    }

    let token = "", doneCount = 0, totalMoney = 0, refreshInterval;

    async function login() {
      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value.trim();
      const proxy = document.getElementById("proxy").value.trim();
      if (!email || !password) return alert("Vui l√≤ng nh·∫≠p ƒë·∫ßy ƒë·ªß!");

      document.getElementById("status").innerText = "‚è≥ ƒêang ƒëƒÉng nh·∫≠p...";
      debug("Login data", { email });

      try {
        const res = await fetch((proxy || "") + "https://api.golike.net/api/login", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ email, password })
        });
        const data = await res.json();
        debug("Login response", data);

        if (data.status === 200 && data.data && data.data.token) {
          token = data.data.token;
          document.getElementById("status").innerText = "‚úÖ ƒêƒÉng nh·∫≠p th√†nh c√¥ng!";
          startAutoRefresh(proxy);
        } else {
          document.getElementById("status").innerText = "‚ùå ƒêƒÉng nh·∫≠p th·∫•t b·∫°i!";
        }
      } catch (err) {
        document.getElementById("status").innerText = "‚ö†Ô∏è L·ªói k·∫øt n·ªëi login!";
        debug("Login error", err.toString());
      }
    }

    async function getJobs(proxy="") {
      if (!token) return;
      document.getElementById("status").innerText = "üîÑ T·∫£i job...";
      debug("Fetching jobs");

      try {
        const res = await fetch(proxy + "https://api.golike.net/api/jobs/getJobs", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": "Bearer " + token
          },
          body: JSON.stringify({ service: "tiktok" })
        });
        const data = await res.json();
        debug("Jobs response", data);

        if (data.status === 200 && Array.isArray(data.data)) {
          renderJobs(data.data);
          document.getElementById("status").innerText = "‚úÖ Job ƒë√£ t·∫£i!";
        } else {
          document.getElementById("status").innerText = "‚ùå L·ªói load job!";
        }
      } catch (err) {
        document.getElementById("status").innerText = "‚ö†Ô∏è L·ªói k·∫øt n·ªëi jobs!";
        debug("Jobs error", err.toString());
      }
    }

    function renderJobs(jobs) {
      const jobList = document.getElementById("jobList");
      jobList.innerHTML = "";
      jobs.forEach(job => {
        const div = document.createElement("div");
        div.className = "job";
        div.innerHTML = `
          <b>Job:</b> ${job.id} | <b>Ti·ªÅn:</b> ${job.price}ƒë <br>
          <a href="${job.link}" target="_blank">üîó Xem video</a><br><br>
          <button onclick="completeJob('${job.id}', ${job.price}, proxy)">Ho√†n th√†nh</button>
        `;
        jobList.appendChild(div);
      });
    }

    function startAutoRefresh(proxy="") {
      if (refreshInterval) clearInterval(refreshInterval);
      getJobs(proxy);
      refreshInterval = setInterval(() => getJobs(proxy), 30000);
      document.getElementById("status").innerText = "‚è≥ T·ª± ƒë·ªông refresh job m·ªói 30s...";
    }

    async function completeJob(jobId, price, proxy="") {
      try {
        const res = await fetch(proxy + "https://api.golike.net/api/jobs/completeJob", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            "Authorization": "Bearer " + token
          },
          body: JSON.stringify({ job_id: jobId })
        });
        const data = await res.json();
        debug("CompleteJob response", data);

        if (data.status === 200) {
          alert("‚úÖ Ho√†n th√†nh job " + jobId);
          doneCount++;
          totalMoney += price || 0;
          document.getElementById("doneCount").innerText = doneCount;
          document.getElementById("totalMoney").innerText = totalMoney;
          getJobs(proxy);
        } else {
          alert("‚ùå Ho√†n th√†nh th·∫•t b·∫°i!");
        }
      } catch (err) {
        alert("‚ö†Ô∏è L·ªói k·∫øt n·ªëi complete!");
        debug("Complete error", err.toString());
      }
    }
  </script>
</body>
  </html>
